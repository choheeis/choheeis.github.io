---
layout: post
title:  "[AWS] 🔥 AWS로 페이스북 로그인 기능 만들기"
date:   2019-10-05 18:34:10 +0700
categories: [AWS]
---

> AUSG 활동의 첫 시작으로 AWS의 amplify 서비스에서 제공하는 SNS 로그인 인증 기능을 만들어볼 것이다!

<br>

## ️️ 🔥 일단 AWS 사이트부터 들어가보자..!
---

- _1단계 - AWS 사이트부터 탐방한다_

	[AWS](https://aws.amazon.com/ko/) 공식 사이트에 들어가니 상단 배너에 제품, 솔루션, 요금, 설명서, 학습하기 등등 여러 메뉴가 있었다. 그 중, 제품 메뉴로 들어가면 AWS에서 제공하는 서비스를 여러 분야로 분류해 놓은 것이 나오는데 나는 안드로이드 개발을 할 것이니 <u>모바일</u> 분류군을 살펴보았다. 모바일 분류군에 속하는 서비스 중 모바일 및 웹 애플리케이션의 구축과 배포라는 설명으로 [Amplify](https://aws.amazon.com/ko/amplify/?nc2=h_m1) 라는 것이 있었다! 

	<br>

	> 아래 내용들은 위 Amplify 링크로 걸어놓은 사이트에 들어가서 조금 훑어보면서 Amplify가 무엇인지 알아본 내용들이다 😀

	![01](https://user-images.githubusercontent.com/31889335/66255802-0df04580-e7c3-11e9-8418-1afa961c8681.PNG)

	<br>

	- AWS Amplify는 모바일 백엔드단을 프론트엔드단과 쉽게 __통합__ 해주는 __프레임워크__ 이다. 좀 더 읽어보니 방금 이 말의 뜻을 알게되었다!

		즉, 모바일 어플리케이션 개발을 하다보면 우리가 백엔드단에서 구현해야하는 여러 기능들이 있는데 요즘에는 백엔드 기능들을 클라우드를 이용해서 개발하는 경우가 많다. 이런 기능에 속하는 것들은 Authentication(인증), analytics(분석), or offline data sync(데이터 동기화) 등이 있다. 

		__프론트엔드 개발자가 이런 백엔드 개발이 필요한 기능들을 선택하기만 하면 AWS Amplify가 각 기능을 제공하는 AWS 서비스를 자동으로 할당하고, 관리해주는 것이다!__

		그런 다음, 프론트엔드 개발자는 __Amplify가 제공하는 라이브러리들과 UI 구성 요소들을 통해 선택한 기능을 애플리케이션에 통합__ 할 수 있게 된다!

		<br>

	![02](https://user-images.githubusercontent.com/31889335/66255742-45122700-e7c2-11e9-9ba5-f4ba6f1073cd.PNG)

	<br>

	- 위와 같은 역할을 하는 Amplify 는 CLI 명령어를 제공하기 때문에 CLI 사용법을 익혀둔다면 더욱 쉽게 Amplify 프레임워크를 사용할 수 있다.

	<br>

	![03](https://user-images.githubusercontent.com/31889335/66255773-ae923580-e7c2-11e9-9e6d-974f6f1ba199.PNG)

	<br>

	- 위 그림에서 설명된 것처럼 Amplify 를 이용해서 사용할 수 있는 AWS 서비스는 다양하다!
	
	<br>

- _2단계 - Amplify를 시작한다_

	위에 있는 그림 중 [시작하기](https://aws-amplify.github.io/docs/) 라는 버튼이 있는 그림이 있는데 이 버튼을 클릭해서 Amplify 를 시작(?)했다. ㅋㅋㅋㅋ 이게 시작한 거지 뭐,,,!

	Amplify를 이용하기 위해 이 사이트에서 제공해주는 __Get started__ 과정을 따라하면 된다! Amplify를 본격적으로 시작하려면 3가지를 해주면 되는데 __1) AWS 계정 생성하기__ , __2) CLI 설치하기__ , __3) 내 애플리케이션 빌드하기(Amplify가 적용된 애플리케이션 첫 빌드)__ 이다!!

	> 😱 CLI를 설치하여서 사용하기 위해서는 [node.js](https://nodejs.org/en/download/) 와 npm이 설치되어 있어야 한다. node.js에 연결되어 있는 링크에서 npm 까지 포함해서 설치할 수 있다!
	>
	> 😱 설명부분에 추가로 동영상이 있는 경우도 있는데 영상을 보면 설치방법을 더 자세히 알 수 있다! 꼭 보기!
	>
	> 😱 만약, cli를 설치하는 도중 파이썬 실행 관련 오류가 난다면 [여기를 참고!](https://github.com/felixrieseberg/windows-build-tools/issues/56)
	>
	> 😱 AWS resion을 선택하라는 말이 나온다면? [여기를 참고!](https://docs.aws.amazon.com/ko_kr/general/latest/gr/rande.html)
	>
	> 😱 3번 내 애플리케이션 빌드를 진행하려면 [이곳](https://aws-amplify.github.io/docs/android/start?ref=amplify-android-btn)으로 이동하여 이 사이트의 getting started를 따라하면 된다!

	<br>
	
	- 3단계 더 자세히 알아보기

		getting started를 따라하다 보면 __awsconfiguration.json__ 이라는 파일이 안드로이드 앱 프로젝트 폴더 내부에 생성되고, 앱 빌드시 SDK에 의해 자동적으로 이 파일이 사용된다!

		> awsconfiguration.json 이라는 파일은 안드로이드 개발자가 사용할 AWS 서비스들을 구성해주는 파일이다.

		Step 5는 데이터베이스에 데이터를 넣는 방법을 알려주는 것이여서 지금은 패스했다! 즉, 3단계의 step 4 까지만 한 상태!

	<br>

	위 3가지를 사이트에서 알려주는대로 따라하면 Amplify를 사용하기 위한 준비가 끝이 난다!!

	그리고, 이 getting started를 끝까지 읽어보면 Amplify로 할 수 있는 것들이 나오는데 이 중 [Authentication](https://aws-amplify.github.io/docs/android/authentication) 이 SNS 로그인 기능이다!

	![04](https://user-images.githubusercontent.com/31889335/66269270-9503f300-e881-11e9-8a92-c9fa90ec83a2.PNG)

	<br>

##  🔥 Authentication 문서 읽어보기 + 따라하기!
---

- _무작정 해석해보았다..영어..잉글리쉬..ㅠㅠ_
	
	__AWSMobileClient__ 라는 것이 인증 기능을 사용하기 원하는 개발자에게 해당 API를 제공해주는 녀석이다. AWSMObileClient는 선언적 함수도 제공하고, 자동적인 토큰? 과 어플리케이션의 workflow를 추적할 수 있게 해준다.

	> 음.. 어렵다

	<br>

	__Amazon Cognito User Pool__ 

	아마존 코그니토 유저 풀은 사용자 등록, 저장소, 인증, 계정 회복 등을 다룰 수 있는 사용자 directory 서비스이다.

	Cognito User Pool은 당신의 어플에 JWT 토큰을 반환한다.

	__Amazon Cognito Federated Identities__ 는 AWS 서비스를 사용해서 당신의 유저를 인증할 수 있는 방법이다. 

	이 두 가지를 함께 사용하면 Cognito User Pool은 Cognito Federated Identities를 위한 유저 신원의 소스가 되는 것이다. 

	Amplify는 이러한 Cognito User Pool을 당신의 유저 정보를 저장하기 위해 사용하고, 인증을 다루기 위해 사용하며 유저가 AWS의 다른 서비스에 엑세스하는 것을 관리하기 위해 사용한다. (예 - AWS S3에 사진을 업로드 하는 것) 

	<br>

	__그럼 어떻게 동작할까?__

	AWSMobileClient는 인증과 관련된 작업을 위해 당신의 어플을 관리한다. 그리고, 어플리케이션을 사용하는 당신의 유저의 로그인 상태를 알기 위한 쿼리를 제공한다.

	예를 들어, 당신의 유저가 어플리케이션에 로그인 했는지 로그아웃 했는지를 체크할 수 있다.  

	또한, AWSMobileClient는 당신의 유저의 로그인 상태 변화에 대한 실시간 알림도 제공한다. 

	AWSMobileClient는 유효한 JWT 토큰들을 당신의 캐시로부터 반환한다. 만약 토큰들이 만료되었다면 캐시 내에서 refresh 토큰이 있는지 찾는다. 만약 만료되지 않은 토큰이 있다면 그 토큰의 IdToken 과 AccessToken 을 가져오고 이것들을 캐시에 저장할 것이다.

	만약, refresh 토큰까지 만료되었다면 당신은 AppSync GraphQL request 나 S3 upload 같은 것을 요청해야 한다. 그러면 AWSMobileClient가 로그인을 다시 해야 한다는 알림을 띄울 것이다. 

	<br>

	__AWS Credentials__

	AWS Credential(증명서)는 AWS IAM 서비스나 Amazon Cognito Identity Pool를 사용하는 서비스에게 서명 요철을 하기 위해 사용된다.

	JWT 토큰과 비슷하게 AWS Credential 은 AWSMobileClient에 의해 당신의 캐시로부터 반환된다. 

	<br>

	__Offline support__

	AWSMobileClient는 오프라인에서 온라인까지 연결되어 있는 어플리케이션을 위한 계정에 최적화 되어있다. 따라서 AWS Credential 을 적절한 시간에 refresh 해준다. 유저가 어플에 연결되어 있지 않다고 해서 자동으로 로그아웃되는 경우는 없을 것이다. 

	> ㅋㅋㅋㅋㅋㅋㅋ 무슨 말인지 감은 오지만 확실히 설명은 못하겠다,,^^

	<br>

- _안드로이드 스튜디오에 지금부터 코드 넣기_

	> 위에 설명들은 AWSMobileClient에 대한 설명이였던 것 같다.. 

	<br>

	안드로이드 스튜디오에서 amplify init을 한 후에 App build.gradle에 아래의 코드를 추가해야 한다.

	~~~kotlin
	//For AWSMobileClient only:
	implementation 'com.amazonaws:aws-android-sdk-mobile-client:2.15.+'

	//For the drop-in UI also:
	implementation 'com.amazonaws:aws-android-sdk-auth-userpools:2.15.+'
	implementation 'com.amazonaws:aws-android-sdk-auth-ui:2.15.+'
	~~~

	그리고 drop-in UI 를 사용하려면 misSdkVersion을 23으로 세팅해야 한다.

	> drop-in UI가 뭔지는 모르겠지만 일단 23으로 맞췄다.

	그 다음, 메니페스트 파일에 아래의 코드를 추가한다.

	~~~kotlin
	<uses-permission android:name="android.permission.INTERNET"/>

	<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/>
	~~~

	여기까지 한 다음 빌드해보자!

	그 다음 자동 setup을 진행해야 한다. cmd창을 통해 amplify를 사용하는 어플의 프로젝트 파일로 이동한 후, 아래 명령어를 입력한다!

	~~~
	$ amplify add auth
	~~~ 

https://aws.amazon.com/ko/cognito/음.. 여기를 해야할거 같은데..









